index.html
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>XAU/USD 証拠金シミュレーター</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
  label { display: block; margin-top: 10px; }
  input, select, button { margin-top: 5px; width: 100%; padding: 5px; }
  .result { margin-top: 15px; padding: 10px; border: 1px solid #ccc; background: #f9f9f9; }
</style>
</head>
<body>

<h2>XAU/JPY 証拠金シミュレーター</h2>

<!-- 必須項目 -->
<label>純資産額 (円)
  <input type="number" id="capital" placeholder="例: 1000000">
</label>

<label>買い / 売り
  <select id="position">
    <option value="buy">買い</option>
    <option value="sell">売り</option>
  </select>
</label>

<label>最大レバレッジ
  <select id="leverage">
    <option value="1">1倍</option>
    <option value="2">2倍</option>
    <option value="5">5倍</option>
    <option value="10">10倍</option>
    <option value="25">25倍</option>
    <option value="50">50倍</option>
    <option value="100">100倍</option>
    <option value="200">200倍</option>
    <option value="500">500倍</option>
    <option value="1000">1000倍</option>
  </select>
</label>

<label>レート (円)
  <input type="number" id="rateInput" placeholder="レートを取得" step="0.01">
  <button type="button" onclick="getCurrentRate()">現在レート取得</button>
</label>

<label>取引数量 (ロット)
  <input type="number" id="lot" placeholder="例: 0.1" step="0.01">
</label>

<label>ロスカット証拠金維持率 (%) 
  <select id="marginRate">
    <option value="20">20%</option>
    <option value="30">30%</option>
    <option value="50" selected>50%</option>
    <option value="70">70%</option>
  </select>
</label>

<!-- 任意項目 -->
<label>利確 (pips)
  <input type="number" id="takeProfit" placeholder="任意">
</label>

<label>損切り (pips)
  <input type="number" id="stopLoss" placeholder="任意">
</label>

<button type="button" onclick="calculate()">計算する</button>

<div class="result" id="result"></div>

<script>
// 自動レート取得
async function getCurrentRate() {
  try {
    const response = await fetch("https://api.exchangerate.host/convert?from=XAU&to=JPY");
    const data = await response.json();
    const rate = data.info.rate;
    document.getElementById("rateInput").value = rate.toFixed(2);
  } catch (error) {
    alert("レート取得に失敗しました。手動入力してください");
    console.error(error);
  }
}

// 証拠金計算
function calculate() {
  const capital = parseFloat(document.getElementById("capital").value);
  const lot = parseFloat(document.getElementById("lot").value);
  const leverage = parseFloat(document.getElementById("leverage").value);
  const rate = parseFloat(document.getElementById("rateInput").value);
  const marginRate = parseFloat(document.getElementById("marginRate").value);
  const tp = parseFloat(document.getElementById("takeProfit").value);
  const sl = parseFloat(document.getElementById("stopLoss").value);

  if (!capital || !lot || !rate) {
    alert("必須項目を入力してください");
    return;
  }

  // 必要証拠金
  const contractSize = 100; // XAUは通常100oz/lot
  const requiredMargin = (lot * contractSize * rate) / leverage;
  const totalMargin = requiredMargin; // 今回は単一ポジション
  const maintenanceRate = marginRate / 100;
  const maintenanceMargin = totalMargin * maintenanceRate;

  // ロスカットレート・損失
  const position = document.getElementById("position").value;
  let liquidationRate, liquidationLoss;
  if (position === "buy") {
    liquidationRate = rate - (capital - maintenanceMargin)/(lot*contractSize);
    liquidationLoss = capital - maintenanceMargin;
  } else {
    liquidationRate = rate + (capital - maintenanceMargin)/(lot*contractSize);
    liquidationLoss = capital - maintenanceMargin;
  }

  let resultText = `
    必要証拠金: ${requiredMargin.toFixed(0)} 円<br>
    合計必要証拠金: ${totalMargin.toFixed(0)} 円<br>
    維持率100%レート: ${rate.toFixed(2)} 円<br>
    維持率100%損失: ${capital.toFixed(0)} 円<br>
    ロスカットレート: ${liquidationRate.toFixed(2)} 円<br>
    ロスカット損失: ${liquidationLoss.toFixed(0)} 円<br>
    レバレッジ: ${leverage}倍
  `;

  if (!isNaN(tp)) {
    const profit = lot * contractSize * (tp / 0.01); // pips計算
    resultText += `<br>利確pips利益: ${profit.toFixed(0)} 円`;
  }

  if (!isNaN(sl)) {
    const loss = lot * contractSize * (sl / 0.01);
    resultText += `<br>損切りpips損失: ${loss.toFixed(0)} 円`;
  }

  document.getElementById("result").innerHTML = resultText;
}
</script>

</body>
</html>
